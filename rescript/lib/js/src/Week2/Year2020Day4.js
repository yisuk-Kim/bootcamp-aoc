// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Fs = require("fs");
var Belt_Int = require("rescript/lib/js/belt_Int.js");
var Belt_Array = require("rescript/lib/js/belt_Array.js");
var Belt_Option = require("rescript/lib/js/belt_Option.js");
var Caml_option = require("rescript/lib/js/caml_option.js");
var Belt_MapString = require("rescript/lib/js/belt_MapString.js");

var input = Fs.readFileSync("input/Week2/Year2020Day4.input.txt", "utf8");

function parsePassport(input) {
  var splitField = function (data) {
    return data.split(/\s/);
  };
  var splitKeyValue = function (data) {
    return data.split(":");
  };
  var arrayToTuple = function (data) {
    return Belt_Array.keepMap(Belt_Array.map(data, (function (x) {
                      var match = Belt_Array.get(x, 0);
                      var match$1 = Belt_Array.get(x, 1);
                      if (match !== undefined && match$1 !== undefined) {
                        return [
                                Caml_option.valFromOption(match),
                                Caml_option.valFromOption(match$1)
                              ];
                      }
                      
                    })), (function (x) {
                  return x;
                }));
  };
  var arrayToMap = Belt_MapString.fromArray;
  var mapToPassport = function (data) {
    var byr = Belt_MapString.get(data, "byr");
    var iyr = Belt_MapString.get(data, "iyr");
    var eyr = Belt_MapString.get(data, "eyr");
    var hgt = Belt_MapString.get(data, "hgt");
    var hcl = Belt_MapString.get(data, "hcl");
    var ecl = Belt_MapString.get(data, "ecl");
    var pid = Belt_MapString.get(data, "pid");
    var cid = Belt_MapString.get(data, "cid");
    if (byr !== undefined && iyr !== undefined && eyr !== undefined && hgt !== undefined && hcl !== undefined && ecl !== undefined && pid !== undefined) {
      return {
              byr: byr,
              iyr: iyr,
              eyr: eyr,
              hgt: hgt,
              hcl: hcl,
              ecl: ecl,
              pid: pid,
              cid: cid
            };
    }
    
  };
  return Belt_Array.map(Belt_Array.map(Belt_Array.map(Belt_Array.map(Belt_Array.map(Belt_Array.map(input.split("\n\n"), splitField), (function (xs) {
                                return Belt_Array.keepMap(xs, (function (x) {
                                              return x;
                                            }));
                              })), (function (x) {
                            return Belt_Array.map(x, splitKeyValue);
                          })), arrayToTuple), arrayToMap), mapToPassport);
}

function filterNone(data) {
  return Belt_Array.keepMap(data, (function (x) {
                return x;
              }));
}

function countPassport(data) {
  return data.length;
}

var data = parsePassport(input);

console.log(Belt_Array.keepMap(data, (function (x) {
            return x;
          })).length);

function parsePassport2(input) {
  var splitter = function (data) {
    var splitField = function (data) {
      return data.split(/\s/);
    };
    var splitKeyValue = function (data) {
      return data.split(":");
    };
    return Belt_Array.map(Belt_Array.map(Belt_Array.map(data.split("\n\n"), splitField), (function (xs) {
                      return Belt_Array.keepMap(xs, (function (x) {
                                    return x;
                                  }));
                    })), (function (x) {
                  return Belt_Array.map(x, splitKeyValue);
                }));
  };
  var arrayToTuple = function (data) {
    var match = Belt_Array.get(data, 0);
    var match$1 = Belt_Array.get(data, 1);
    if (match !== undefined && match$1 !== undefined) {
      return [
              match,
              match$1
            ];
    }
    
  };
  var sequence = function (input) {
    if (Belt_Array.some(input, Belt_Option.isNone)) {
      return ;
    } else {
      return Belt_Array.keepMap(input, (function (x) {
                    return x;
                  }));
    }
  };
  var tupleArrayToMap = Belt_MapString.fromArray;
  var parseRange = function (num, min, max) {
    var match = num >= min;
    var match$1 = num <= max;
    if (match && match$1) {
      return num;
    }
    
  };
  var parseHeight = function (str) {
    var stringToHeight = function (str) {
      var unit = str.slice(-2);
      var value = Belt_Int.fromString(str.slice(0, -2));
      switch (unit) {
        case "cm" :
            if (value !== undefined) {
              return {
                      TAG: /* Cm */0,
                      _0: value
                    };
            } else {
              return ;
            }
        case "in" :
            if (value !== undefined) {
              return {
                      TAG: /* In */1,
                      _0: value
                    };
            } else {
              return ;
            }
        default:
          return ;
      }
    };
    var parseValueByUnit = function (hgt) {
      if (hgt.TAG === /* Cm */0) {
        return Belt_Option.map(parseRange(hgt._0, 150, 193), (function (x) {
                      return {
                              TAG: /* Cm */0,
                              _0: x
                            };
                    }));
      } else {
        return Belt_Option.map(parseRange(hgt._0, 59, 76), (function (x) {
                      return {
                              TAG: /* In */1,
                              _0: x
                            };
                    }));
      }
    };
    return Belt_Option.flatMap(stringToHeight(str), parseValueByUnit);
  };
  var parseHairColor = function (str) {
    var rule = /^#[a-z0-9+]{6}$/;
    if (rule.test(str)) {
      return str;
    }
    
  };
  var parseEyeColor = function (str) {
    switch (str) {
      case "amb" :
          return /* Amb */0;
      case "blu" :
          return /* Blu */1;
      case "brn" :
          return /* Brn */2;
      case "grn" :
          return /* Grn */4;
      case "gry" :
          return /* Gry */3;
      case "hzl" :
          return /* Hzl */5;
      case "oth" :
          return /* Oth */6;
      default:
        return ;
    }
  };
  var parsePassportId = function (str) {
    var rule = /^0*[0-9+]{9}$/;
    if (rule.test(str)) {
      return str;
    }
    
  };
  var mapToPassport2 = function (data) {
    var byr = Belt_Option.flatMap(Belt_Option.flatMap(Belt_MapString.get(data, "byr"), Belt_Int.fromString), (function (x) {
            return parseRange(x, 1920, 2002);
          }));
    var iyr = Belt_Option.flatMap(Belt_Option.flatMap(Belt_MapString.get(data, "iyr"), Belt_Int.fromString), (function (x) {
            return parseRange(x, 2010, 2020);
          }));
    var eyr = Belt_Option.flatMap(Belt_Option.flatMap(Belt_MapString.get(data, "eyr"), Belt_Int.fromString), (function (x) {
            return parseRange(x, 2020, 2030);
          }));
    var hgt = Belt_Option.flatMap(Belt_MapString.get(data, "hgt"), parseHeight);
    var hcl = Belt_Option.flatMap(Belt_MapString.get(data, "hcl"), parseHairColor);
    var ecl = Belt_Option.flatMap(Belt_MapString.get(data, "ecl"), parseEyeColor);
    var pid = Belt_Option.flatMap(Belt_MapString.get(data, "pid"), parsePassportId);
    var cid = Belt_MapString.get(data, "cid");
    if (byr !== undefined && iyr !== undefined && eyr !== undefined && hgt !== undefined && hcl !== undefined && ecl !== undefined && pid !== undefined) {
      return {
              byr: byr,
              iyr: iyr,
              eyr: eyr,
              hgt: hgt,
              hcl: hcl,
              ecl: ecl,
              pid: pid,
              cid: cid
            };
    }
    
  };
  return Belt_Array.map(Belt_Array.map(Belt_Array.map(Belt_Array.map(splitter(input), (function (x) {
                            return Belt_Array.map(x, arrayToTuple);
                          })), sequence), (function (x) {
                    return Belt_Option.map(x, tupleArrayToMap);
                  })), (function (x) {
                return Belt_Option.flatMap(x, mapToPassport2);
              }));
}

var data$1 = parsePassport2(input);

console.log(Belt_Array.keepMap(data$1, (function (x) {
            return x;
          })).length);

exports.input = input;
exports.parsePassport = parsePassport;
exports.filterNone = filterNone;
exports.countPassport = countPassport;
exports.parsePassport2 = parsePassport2;
/* input Not a pure module */
